DROP TABLE "message" CASCADE;
ALTER TABLE "user" RENAME COLUMN "read_messages" TO "read_notifications";
CREATe TABLE "user_notification_pref"("id" SERIAL PRIMARY KEY UNIQUE,"user" INT8 NOT NULL,"type" VARCHAR NOT NULL,"delivery" VARCHAR NOT NULL);
ALTER TABLE "user_notification_pref" ADD CONSTRAINT "unique_user_notification_pref" UNIQUE("user","type");
ALTER TABLE "user_notification_pref" ADD CONSTRAINT "user_notification_pref_user_fkey" FOREIGN KEY("user") REFERENCES "user"("id");
CREATe TABLE "notification"("id" SERIAL PRIMARY KEY UNIQUE,"created_ts" TIMESTAMP NOT NULL,"type" VARCHAR NOT NULL,"to" INT8 NOT NULL,"project" INT8 NULL,"content" VARCHAR NOT NULL,"archived" BOOLEAN NOT NULL);
ALTER TABLE "notification" ADD CONSTRAINT "notification_to_fkey" FOREIGN KEY("to") REFERENCES "user"("id");
ALTER TABLE "notification" ADD CONSTRAINT "notification_project_fkey" FOREIGN KEY("project") REFERENCES "project"("id");
CREATe TABLE "unapproved_comment_notification"("id" SERIAL PRIMARY KEY UNIQUE,"comment" INT8 NOT NULL,"notification" INT8 NOT NULL);
ALTER TABLE "unapproved_comment_notification" ADD CONSTRAINT "unapproved_comment_notification_comment_fkey" FOREIGN KEY("comment") REFERENCES "comment"("id");
ALTER TABLE "unapproved_comment_notification" ADD CONSTRAINT "unapproved_comment_notification_notification_fkey" FOREIGN KEY("notification") REFERENCES "notification"("id");
CREATe TABLE "event_notification_sent"("id" SERIAL PRIMARY KEY UNIQUE,"ts" TIMESTAMP NOT NULL,"notification" INT8 NOT NULL);
ALTER TABLE "event_notification_sent" ADD CONSTRAINT "event_notification_sent_notification_fkey" FOREIGN KEY("notification") REFERENCES "notification"("id");
